{
  "id": "IMPL-001",
  "title": "移除 API 路由中的 router.prefix() 定义",
  "status": "pending",
  "context_package_path": ".workflow/active/WFS-fix-deno-deploy-api-routes-404/.process/context-package.json",
  "cli_execution_id": "WFS-fix-deno-deploy-api-routes-404-IMPL-001",
  "cli_execution": {
    "strategy": "new"
  },
  "meta": {
    "type": "refactor",
    "agent": "@code-developer",
    "execution_group": null,
    "module": null,
    "execution_config": {
      "method": "agent",
      "cli_tool": "not_applicable",
      "enable_resume": false,
      "previous_cli_id": null
    }
  },
  "context": {
    "requirements": [
      "修改 3 个路由文件: [src/presentation/api/v1/config.route.ts, src/presentation/api/v1/health.route.ts, src/presentation/api/v1/stats.route.ts]",
      "从每个文件中移除 router.prefix('/api') 调用",
      "保留路由定义: [config.get('/config'), health.get('/health'), health.get('/health/check'), stats.get('/stats')]",
      "确保路由导出保持不变: [export const configRouter, export const healthRouter, export const statsRouter]"
    ],
    "focus_paths": [
      "src/presentation/api/v1/config.route.ts",
      "src/presentation/api/v1/health.route.ts",
      "src/presentation/api/v1/stats.route.ts"
    ],
    "acceptance": [
      "3 个文件移除 router.prefix(): verify by grep -n 'router.prefix' src/presentation/api/v1/*.route.ts | wc -l = 0",
      "路由导出存在: verify by grep -n 'export const.*Router' src/presentation/api/v1/*.route.ts | wc -l = 3",
      "路由路径定义保留: verify by grep -n '.get\\|.post' src/presentation/api/v1/*.route.ts | wc -l >= 4",
      "TypeScript 编译无错误: verify by deno check --remote src/presentation/api/v1/*.route.ts (exit code 0)"
    ],
    "depends_on": [],
    "inherited": null,
    "shared_context": {
      "tech_stack": ["Deno", "Oak v12.6.1", "TypeScript"],
      "conventions": [
        "路由文件导出 Router 实例",
        "路由定义使用 router.get(), router.post() 等方法",
        "路径前缀将在 main.ts 中通过 app.use() 指定"
      ]
    },
    "artifacts": []
  },
  "flow_control": {
    "pre_analysis": [
      {
        "step": "load_context_package",
        "action": "加载上下文包获取路由文件位置和当前模式",
        "commands": [
          "Read(D:\\Code\\tvbox\\.workflow\\active\\WFS-fix-deno-deploy-api-routes-404\\.process\\context-package.json)"
        ],
        "output_to": "context_package",
        "on_error": "fail"
      },
      {
        "step": "load_exploration_results",
        "action": "加载探索结果获取当前路由模式的详细分析",
        "commands": [
          "Read(D:\\Code\\tvbox\\.workflow\\active\\WFS-fix-deno-deploy-api-routes-404\\.process\\explorations-manifest.json)",
          "Read(D:\\Code\\tvbox\\.workflow\\active\\WFS-fix-deno-deploy-api-routes-404\\.process\\exploration-architecture.json)"
        ],
        "output_to": "exploration_analysis",
        "on_error": "skip_optional"
      },
      {
        "step": "verify_current_pattern",
        "action": "验证当前路由文件中使用 router.prefix() 的模式",
        "commands": [
          "bash(grep -n 'router.prefix' src/presentation/api/v1/*.route.ts)"
        ],
        "output_to": "current_pattern",
        "on_error": "continue"
      }
    ],
    "implementation_approach": [
      {
        "step": 1,
        "title": "修改 config.route.ts",
        "description": "从 configRouter 中移除 router.prefix('/api') 调用",
        "modification_points": [
          "移除 src/presentation/api/v1/config.route.ts 中的 router.prefix('/api')",
          "保留 configRouter.get('/config') 路由定义",
          "保留 export const configRouter"
        ],
        "logic_flow": [
          "读取 src/presentation/api/v1/config.route.ts",
          "定位 router.prefix('/api') 调用行",
          "移除该行代码",
          "验证其他路由定义和导出保持不变"
        ],
        "depends_on": [],
        "output": "config_route_modified"
      },
      {
        "step": 2,
        "title": "修改 health.route.ts",
        "description": "从 healthRouter 中移除 router.prefix('/api') 调用",
        "modification_points": [
          "移除 src/presentation/api/v1/health.route.ts 中的 router.prefix('/api')",
          "保留 healthRouter.get('/health') 和 healthRouter.get('/health/check') 路由定义",
          "保留 export const healthRouter"
        ],
        "logic_flow": [
          "读取 src/presentation/api/v1/health.route.ts",
          "定位 router.prefix('/api') 调用行",
          "移除该行代码",
          "验证其他路由定义和导出保持不变"
        ],
        "depends_on": [],
        "output": "health_route_modified"
      },
      {
        "step": 3,
        "title": "修改 stats.route.ts",
        "description": "从 statsRouter 中移除 router.prefix('/api') 调用",
        "modification_points": [
          "移除 src/presentation/api/v1/stats.route.ts 中的 router.prefix('/api')",
          "保留 statsRouter.get('/stats') 路由定义",
          "保留 export const statsRouter"
        ],
        "logic_flow": [
          "读取 src/presentation/api/v1/stats.route.ts",
          "定位 router.prefix('/api') 调用行",
          "移除该行代码",
          "验证其他路由定义和导出保持不变"
        ],
        "depends_on": [],
        "output": "stats_route_modified"
      },
      {
        "step": 4,
        "title": "验证修改",
        "description": "验证所有路由文件已正确移除 prefix,且导出和路由定义保留",
        "modification_points": [
          "验证 3 个文件中不存在 router.prefix() 调用",
          "验证所有路由导出存在",
          "验证路由路径定义保留",
          "运行 TypeScript 编译检查"
        ],
        "logic_flow": [
          "使用 grep 搜索 router.prefix 确认已移除",
          "使用 grep 验证路由导出存在",
          "使用 grep 验证路由定义保留",
          "运行 deno check 进行编译检查"
        ],
        "depends_on": [1, 2, 3],
        "output": "verification_complete"
      }
    ],
    "target_files": [
      "src/presentation/api/v1/config.route.ts",
      "src/presentation/api/v1/health.route.ts",
      "src/presentation/api/v1/stats.route.ts"
    ]
  }
}
