# TVBox èšåˆæœåŠ¡ - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

### å‰ç½®è¦æ±‚

- Deno è´¦æˆ·ï¼ˆå…è´¹æ³¨å†Œï¼šhttps://deno.com/deployï¼‰
- GitHub è´¦æˆ·ï¼ˆå¯é€‰ï¼Œç”¨äº CI/CDï¼‰

### æ­¥éª¤ 1: å®‰è£… Deno CLI

#### Windows (PowerShell)
```powershell
irm https://deno.land/install.ps1 | iex
```

#### macOS/Linux
```bash
curl -fsSL https://deno.land/install.sh | sh
```

éªŒè¯å®‰è£…ï¼š
```bash
deno --version
```

### æ­¥éª¤ 2: ç™»å½• Deno Deploy

```bash
deno login
```

è¿™ä¼šæ‰“å¼€æµè§ˆå™¨è¿›è¡Œæˆæƒã€‚

### æ­¥éª¤ 3: éƒ¨ç½²é¡¹ç›®

#### æ–¹å¼ A: è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd D:\Code\tvbox

# è¿è¡Œéƒ¨ç½²è„šæœ¬
bash scripts/deploy.sh
```

#### æ–¹å¼ B: æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. å®‰è£… deployctl
deno install -A -f https://deno.land/x/deployctl/deployctl.ts

# 2. éƒ¨ç½²
deployctl deploy \
  --project=tvbox-aggregator \
  --entrypoint=src/main.ts \
  --prod
```

### æ­¥éª¤ 4: è®¿é—®æœåŠ¡

éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ï¼š
```
âœ… éƒ¨ç½²å®Œæˆï¼
ğŸŒ è®¿é—®: https://tvbox-aggregator.deno.dev
```

#### å¯ç”¨çš„ç«¯ç‚¹ï¼š

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `/` | å¥åº·æ£€æŸ¥ |
| `/api/config` | è·å–èšåˆé…ç½® |
| `/api/health` | æŸ¥çœ‹å¥åº·çŠ¶æ€ |
| `/api/stats` | ç³»ç»Ÿç»Ÿè®¡ |
| `/admin` | **ç®¡ç†é¢æ¿** â­ |

è®¿é—®ç®¡ç†é¢æ¿ï¼šhttps://tvbox-aggregator.deno.dev/admin

---

## ğŸ¨ ç®¡ç†é¢æ¿åŠŸèƒ½

### åŠŸèƒ½åˆ—è¡¨

1. **å®æ—¶ç»Ÿè®¡**
   - æ€»è¯·æ±‚æ•°
   - ä»Šæ—¥è¯·æ±‚æ•°
   - å¹³å‡å“åº”æ—¶é—´
   - å¥åº·æºæ•°é‡

2. **é…ç½®æºç®¡ç†**
   - æŸ¥çœ‹æ‰€æœ‰é…ç½®æº
   - å®æ—¶çŠ¶æ€æ˜¾ç¤ºï¼ˆå¥åº·/é™çº§/å¤±è´¥ï¼‰
   - æµ‹è¯•å•ä¸ªæº
   - å¯ç”¨/ç¦ç”¨æº

3. **å¿«é€Ÿæ“ä½œ**
   - åˆ·æ–°ç»Ÿè®¡æ•°æ®
   - è§¦å‘å¥åº·æ£€æŸ¥
   - æ¸…ç©ºç¼“å­˜

### ç•Œé¢é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“º TVBox èšåˆæœåŠ¡ - ç®¡ç†é¢æ¿            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»è¯·æ±‚æ•°: 15,234  ä»Šæ—¥è¯·æ±‚: 1,234      â”‚
â”‚  å“åº”æ—¶é—´: 245ms   å¥åº·æº: 6/7          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åˆ·æ–°ç»Ÿè®¡] [å¥åº·æ£€æŸ¥] [æ¸…ç©ºç¼“å­˜]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é…ç½®æºåˆ—è¡¨:                            â”‚
â”‚  é¥­å¤ªç¡¬     [å¥åº·]  100åˆ†  [æµ‹è¯•][ç¦ç”¨] â”‚
â”‚  é’æŸ        [å¥åº·]  95åˆ†   [æµ‹è¯•][ç¦ç”¨] â”‚
â”‚  weixine   [å¥åº·]  90åˆ†   [æµ‹è¯•][ç¦ç”¨] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š é…ç½®å’Œä½¿ç”¨

### æ·»åŠ æ–°çš„é…ç½®æº

ç¼–è¾‘ `config/sources.json`ï¼š

```json
{
  "id": "new-source",
  "name": "æ–°æºåç§°",
  "url": "https://example.com/config.json",
  "priority": 80,
  "tags": ["æ¨è", "ç¨³å®š"],
  "isRecursive": false,
  "enabled": true
}
```

ç„¶åé‡æ–°éƒ¨ç½²ï¼š
```bash
deno task deploy
```

### è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

1. åœ¨ Deno Deploy æ§åˆ¶å°é€‰æ‹©ä½ çš„é¡¹ç›®
2. ç‚¹å‡» "Settings" â†’ "Custom Domains"
3. æ·»åŠ ä½ çš„åŸŸå
4. é…ç½® DNS è®°å½•

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨éƒ¨ç½²æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
deployctl deploy \
  --project=tvbox-aggregator \
  --entrypoint=src/main.ts \
  --env=CACHE_TTL=3600 \
  --env=HEALTH_CHECK_INTERVAL=900000 \
  --prod
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: éƒ¨ç½²å¤±è´¥

**ç—‡çŠ¶**: `deno task deploy` æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ä»£ç è¯­æ³•
deno check --remote src/main.ts

# 2. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping deno.dev

# 3. é‡æ–°ç™»å½•
deno login
```

### é—®é¢˜ 2: ç®¡ç†é¡µé¢æ— æ³•è®¿é—®

**ç—‡çŠ¶**: `/admin` è¿”å› 404

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `src/main.ts` æ˜¯å¦åŒ…å« `adminRouter`
2. é‡æ–°éƒ¨ç½²æœåŠ¡
3. æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜

### é—®é¢˜ 3: é…ç½®æºå…¨éƒ¨å¤±æ•ˆ

**ç—‡çŠ¶**: `/api/health` æ˜¾ç¤ºæ‰€æœ‰æºå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. éªŒè¯æºé…ç½®
deno task health

# 2. æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
cat reports/health-*.json

# 3. æ›´æ–°å¤±æ•ˆçš„æº
# ç¼–è¾‘ config/sources.json
```

### é—®é¢˜ 4: ç¼“å­˜ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**: å“åº”æ…¢ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸º 0

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Deno KV æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
2. è®¿é—® `/api/stats` æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
3. ç‚¹å‡»ç®¡ç†é¢æ¿çš„"æ¸…ç©ºç¼“å­˜"æŒ‰é’®

---

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### å®šæœŸä»»åŠ¡

å»ºè®®æ¯å‘¨è¿è¡Œä¸€æ¬¡ï¼š

```bash
# å¥åº·æ£€æŸ¥
deno task health

# æŸ¥çœ‹æŠ¥å‘Š
cat reports/health-*.json

# é‡æ–°éƒ¨ç½²ï¼ˆå¦‚æœæœ‰æ›´æ–°ï¼‰
deno task deploy
```

### è®¾ç½®è‡ªåŠ¨å¥åº·æ£€æŸ¥

ä½¿ç”¨ GitHub Actionsï¼ˆæ¨èï¼‰ï¼š

```yaml
# .github/workflows/health-check.yml
name: Health Check

on:
  schedule:
    - cron: '0 0 * * *'  # æ¯å¤© UTC 0:00

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Deno
        uses: denoland/setup-deno@v1
      - name: Run Health Check
        run: deno task health
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿æŠ¤ç®¡ç†é¢æ¿**
   - æ·»åŠ è®¤è¯ä¸­é—´ä»¶
   - é™åˆ¶è®¿é—® IP
   - ä½¿ç”¨ HTTPS

2. **é™åˆ¶è¯·æ±‚é¢‘ç‡**
   - ä½¿ç”¨ API ç½‘å…³
   - å®æ–½é€Ÿç‡é™åˆ¶

3. **å®šæœŸæ›´æ–°**
   - æ›´æ–° Deno ç‰ˆæœ¬
   - æ›´æ–°ä¾èµ–é¡¹
   - ç›‘æ§å®‰å…¨å…¬å‘Š

---

## ğŸ’¡ æœ€ä½³å®è·µ

### æ€§èƒ½ä¼˜åŒ–

1. **å¯ç”¨ç¼“å­˜**ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
   - L1: å†…å­˜ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
   - L2: KV å­˜å‚¨ï¼ˆ1å°æ—¶ï¼‰
   - L3: CDN ç¼“å­˜ï¼ˆ15åˆ†é’Ÿï¼‰

2. **é™åˆ¶å¹¶å‘æ•°**
   - é»˜è®¤å¹¶å‘: 10
   - å¯åœ¨ä»£ç ä¸­è°ƒæ•´

3. **ä½¿ç”¨ CDN**
   - ç»‘å®šè‡ªå®šä¹‰åŸŸå
   - å¯ç”¨ Cloudflare CDN

### æˆæœ¬æ§åˆ¶

Deno Deploy å…è´¹é¢åº¦ï¼š
- âœ… 100,000 è¯·æ±‚/å¤©
- âœ… 50ms CPU æ—¶é—´/è¯·æ±‚
- âœ… 100MB KV å­˜å‚¨

ç›‘æ§ä½¿ç”¨é‡ï¼š
- è®¿é—® Deno Deploy æ§åˆ¶å°
- æŸ¥çœ‹ "Usage" é¡µé¢

---

## ğŸ†˜ è·å–å¸®åŠ©

### æ–‡æ¡£
- [Deno Deploy å®˜æ–¹æ–‡æ¡£](https://deno.com/deploy/docs)
- [Oak æ¡†æ¶æ–‡æ¡£](https://oakserver.github.io/oak/)

### ç¤¾åŒº
- [Deno Discord](https://discord.gg/deno)
- [GitHub Issues](https://github.com/denoland/deno/issues)

### å¸¸è§é—®é¢˜

**Q: æˆ‘å¯ä»¥åœ¨å›½å†…ä½¿ç”¨å—ï¼Ÿ**
A: å¯ä»¥ï¼Deno Deploy å›½å†…è®¿é—®å‹å¥½ï¼Œæ— éœ€ä»£ç†ã€‚

**Q: å…è´¹é¢åº¦å¤Ÿç”¨å—ï¼Ÿ**
A: å¯¹äºä¸ªäººä½¿ç”¨ï¼ˆ1000è¯·æ±‚/å¤©ï¼‰ï¼Œå®Œå…¨å¤Ÿç”¨ã€‚

**Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**
A: å®šæœŸå¯¼å‡º `config/sources.json` å’Œ KV æ•°æ®ã€‚

**Q: å¯ä»¥è¿ç§»åˆ°å…¶ä»–å¹³å°å—ï¼Ÿ**
A: å¯ä»¥ï¼ä»£ç æ”¯æŒ Cloudflare Workers å’Œ Vercel Edgeã€‚

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] å®‰è£… Deno CLI
- [ ] ç™»å½• Deno Deploy
- [ ] æ£€æŸ¥ä»£ç è¯­æ³•ï¼ˆ`deno check --remote src/main.ts`ï¼‰
- [ ] éªŒè¯é…ç½®æºï¼ˆ`deno task health`ï¼‰
- [ ] éƒ¨ç½²æœåŠ¡ï¼ˆ`deno task deploy`ï¼‰
- [ ] è®¿é—®ç®¡ç†é¢æ¿ï¼ˆ`/admin`ï¼‰
- [ ] æµ‹è¯• API ç«¯ç‚¹ï¼ˆ`/api/config`ï¼‰
- [ ] è®¾ç½®è‡ªåŠ¨å¥åº·æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ•…éšœæ’æŸ¥éƒ¨åˆ†æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
